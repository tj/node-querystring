/*!
 * querystring
 * Copyright(c) 2010 TJ Holowaychuk <tj@vision-media.ca>
 * MIT Licensed
 */(function(exports){var toString=Object.prototype.toString,isint=/^[0-9]+$/;function promote(parent,key){if(parent[key].length==0)return parent[key]={};var t={};for(var i in parent[key])t[i]=parent[key][i];return parent[key]=t,t}function parse(parts,parent,key,val){var part=parts.shift();if(!part)Array.isArray(parent[key])?parent[key].push(val):"object"==typeof parent[key]?parent[key]=val:"undefined"==typeof parent[key]?parent[key]=val:parent[key]=[parent[key],val];else{var obj=parent[key]=parent[key]||[];"]"==part?Array.isArray(obj)?""!=val&&obj.push(val):"object"==typeof obj?obj[Object.keys(obj).length]=val:obj=parent[key]=[parent[key],val]:~part.indexOf("]")?(part=part.substr(0,part.length-1),!isint.test(part)&&Array.isArray(obj)&&(obj=promote(parent,key)),parse(parts,obj,part,val)):(!isint.test(part)&&Array.isArray(obj)&&(obj=promote(parent,key)),parse(parts,obj,part,val))}}function merge(parent,key,val){if(~key.indexOf("]")){var parts=key.split("["),len=parts.length,last=len-1;parse(parts,parent,"base",val)}else{if(!isint.test(key)&&Array.isArray(parent.base)){var t={};for(var k in parent.base)t[k]=parent.base[k];parent.base=t}set(parent.base,key,val)}return parent}function parseObject(obj){var ret={base:{}};return Object.keys(obj).forEach(function(name){merge(ret,name,obj[name])}),ret.base}function parseString(str){return String(str).split("&").reduce(function(ret,pair){try{pair=decodeURIComponent(pair.replace(/\+/g," "))}catch(e){}var eql=pair.indexOf("="),brace=lastBraceInKey(pair),key=pair.substr(0,brace||eql),val=pair.substr(brace||eql,pair.length),val=val.substr(val.indexOf("=")+1,val.length);return""==key&&(key=pair,val=""),merge(ret,key,val)},{base:{}}).base}exports.parse=function(str){return null==str||""==str?{}:"object"==typeof str?parseObject(str):parseString(str)};var stringify=exports.stringify=function(obj,prefix){return Array.isArray(obj)?stringifyArray(obj,prefix):"[object Object]"==toString.call(obj)?stringifyObject(obj,prefix):"string"==typeof obj?stringifyString(obj,prefix):prefix+"="+obj};function stringifyString(str,prefix){if(!prefix)throw new TypeError("stringify expects an object");return prefix+"="+encodeURIComponent(str)}function stringifyArray(arr,prefix){var ret=[];if(!prefix)throw new TypeError("stringify expects an object");for(var i=0;i<arr.length;i++)ret.push(stringify(arr[i],prefix+"["+i+"]"));return ret.join("&")}function stringifyObject(obj,prefix){var ret=[],keys=Object.keys(obj),key;for(var i=0,len=keys.length;i<len;++i)key=keys[i],ret.push(stringify(obj[key],prefix?prefix+"["+encodeURIComponent(key)+"]":encodeURIComponent(key)));return ret.join("&")}function set(obj,key,val){var v=obj[key];undefined===v?obj[key]=val:Array.isArray(v)?v.push(val):obj[key]=[v,val]}function lastBraceInKey(str){var len=str.length,brace,c;for(var i=0;i<len;++i){c=str[i],"]"==c&&(brace=!1),"["==c&&(brace=!0);if("="==c&&!brace)return i}}})(window.querystring={});